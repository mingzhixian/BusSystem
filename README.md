# 重庆北碚公交线路换乘推荐系统

## 目的

根据用户所在站和目的站会自动寻找最节省时间、步行最少、换乘最少的方案。

## 部署

1. 根据实际情况修改siteInfo中的站点信息（格式参考siteInfo/rule.md）
2. 编译软件(如未进行第一步可直接进入第三步，无需编译)
3. 运行软件

- 参数说明:
- p：http端口号，默认8090

## 使用

项目默认使用http网页访问提供信息。

- 访问数据格式：{"source":"西南大学站","purpose":"解放碑站","model":"1"}</br>
 model:1--最节省时间、2--步行最少、3--换乘最少
- 返回数据格式：{"route":"4(西南大学站-红旗河沟站)-8(红旗河沟站-解放碑站)","meter":"400","transfer":"1"}

## 项目结构

<pre>
.                            BusSystem
├── README.md                   说明文件
└── src                         源代码
    ├── dataInfo                    程序内部信息存储
    ├── http                        http服务器
    ├── main                        主程序
    ├── pathCalculate               路径计算
    └── siteInfo                    站点信息
</pre>

## 项目说明

### 数据存储

考虑到公交站信息以及站与站之间是否可步行到达等信息交叉起来较为密集，以及简化项目数据结构，提高效率的目的，本项目使用图的方式存储信息，并采用邻接矩阵的图存储方式。<br><br>

因作者无法获取精确信息，所以项目中站点之间的所需的时长以及站点之间是否可通过较短的步行到达等信息均为作者随机产生，重点在于程序本身，如有精准数据可以按照siteinfo文件夹下的rule.md中所规定的规则修改siteinfo.txt中信息。

### 计算方法

在设计之初，我设计的是通过扫描建立图，并根据http提供的信息即时查找两点之间的最短路径，随后可以将结果缓存在http服务器，来提高速度，当站点信息发生更改后，通知http服务器删除缓存，重新计算。<br><br>

但在实际开发过程中，我发现，linux和windows对于内存的管理策略有所不同，在windows上释放变量后，windows会立即释放内存回归系统管理，但是linux为了防止重复申请释放内存，在内存释放后并不会立即回归系统管理，而是进入缓冲池，等程序结束后才会完全释放。<br><br>

而在早期方法中这意味着，当缓存足够多时，最短路径的计算需求几乎没有，而图以及函数等一直保持在内存中，即使进行释放操作也无法减少占用；其次经过测试，最短路径的计算时间复杂度很高。最后，对于公交系统，范围只在一个城市，且站点数量并不是十分多，算出所有站点之间的最短路径并不困难，所以我后期将项目分为两个程序，主程序只运行一次，在建立图后，会计算所有可能的结果，并传送给副程序，随后结束主程序启动副程序，副程序仅维持http服务器，减少项目占用，并避免了首次使用时速度较慢的问题。
